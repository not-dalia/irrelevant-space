<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/assets/favicon.svg" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;family=Frank+Ruhl+Libre:wght@300;400;500;600;700&amp;family=Raleway:ital,wght@0,400;0,500;0,600;0,700;1,400&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="stylesheet" href="/styles/tango.css">
  <title>Irrelevant Space - CSS Trivia: Masonry Grid Layout</title>
</head>

<body id="home">
  <header>
    <h1><a href="/">irrelevant space</a></h1>
    <div class="nav">
      <a href="/notes">notes</a>
      <a href="/endeavours">endeavours</a>
    </div>
  </header>

  <main>
    <div class="col-wrapper" id="note-header">
  <div class="main-col">
    <div class="info">
      <div class="note-type">note</div>
      
      <div class="separator">●</div>
      <div class="age">Created 13 Jan 2024</div>
      <div class="separator">●</div>
      <div class="age">Last updated <date datetime="2024-01-13T02:22:35+00:00">13 Jan 2024</date>
</div>
    </div>
    <h1><span>CSS Trivia: Masonry Grid Layout</span></h1>
    
  </div>
</div>

<div class="content-wrapper" id="note-content">
  <div class="col-wrapper">
    <div class="main-col">
      <p>Pinterest’s layout has always been the defining feature of the site since its inception. It has been used by many others since then, and I’ve always been fascinated by it. Recently, I’ve come to learn that this type of layout is called a Masonry Layout, a name that comes from <a href="https://en.wikipedia.org/wiki/Masonry" class="external-link" target="_blank">the craft of stonemasonry</a>. Another thing I’ve learnt recently is that CSS has an experimental masonry grid layout, with <strong>very limited</strong> browser support. The specifications are outlined in <a href="https://drafts.csswg.org/css-grid-3/" class="external-link" target="_blank">CSS Grid Layout Module Level 3 Editor’s Draft</a> for those who are interested.</p>

<p>  </p>
<blockquote class="wikilink-embed wikilink-asset-embed" data-config="500">
<a href="/assets/masonrybricks.jpg" class="internal-link embed-link" data-embed-url="/assets/masonrybricks.jpg" data-embed-fragment="">500</a><div class="asset-embed meadow-embed"><img src="/assets/masonrybricks.jpg" alt="Image: masonrybricks" width="500"></div>  </blockquote>
<span style="font-size: 0.9rem; text-align: center; display: block; margin-top: -1.2rem;">DALL.E’s interpretation of a masonry layout</span>

<h2 id="creating-a-masonry-layout">Creating a Masonry Layout</h2>
<p>There are a few different ways to achieve this layout. Horizontal masonry layouts are simpler to create than vertical ones<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote internal-link" rel="footnote">1</a></sup>. You can simply use <code class="language-plaintext highlighter-rouge">inline-block</code> elements, or use a <code class="language-plaintext highlighter-rouge">flex</code> container with <code class="language-plaintext highlighter-rouge">flex-wrap: wrap</code> if you want more control over the layout.</p>

<p>For a vertical layout, <code class="language-plaintext highlighter-rouge">flex</code> doesn’t do as well unless you have a fixed height container. An approach I like personally is to use <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/columns" class="external-link" target="_blank">columns</a><sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote internal-link" rel="footnote">2</a></sup>. Column layouts are responsive and allow setting the maximum number of columns. The following CSS creates a column layout with a maximum of 4 columns, each column having the ideal width of <code class="language-plaintext highlighter-rouge">180px</code>, and a gap of <code class="language-plaintext highlighter-rouge">10px</code> between columns<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote internal-link" rel="footnote">3</a></sup>.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#column-layout</span> <span class="p">{</span>
  <span class="nl">columns</span><span class="p">:</span> <span class="m">4</span> <span class="m">180px</span><span class="p">;</span>
  <span class="nl">column-gap</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The main issue with this approach is that the order of the child elements in the layout is vertical, not horizontal. The example below shows the above CSS in action. Note the order of the elements.</p>

<p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="dyrOWVP" data-user="irrelevant-space" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/irrelevant-space/pen/dyrOWVP" class="external-link" target="_blank">
  CSS Masonry Grid Demo</a> by Dalia (<a href="https://codepen.io/irrelevant-space" class="external-link" target="_blank">@irrelevant-space</a>)
  on <a href="https://codepen.io" class="external-link" target="_blank">CodePen</a>.</span>
</p>

<p><br></p>

<p><a href="https://css-tricks.com/piecing-together-approaches-for-a-css-masonry-layout/" class="external-link" target="_blank">Approaches for a CSS Masonry Layout</a> is a great read on the different ways a masonry layout can be achieved. It covers the cases above and more.</p>

<h2 id="enter-masonry-css-grids">Enter Masonry CSS Grids</h2>
<p>So far, <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_grid_layout" class="external-link" target="_blank">CSS grid layout</a> hasn’t been flexible enough to create a masonry layout, but this might be about to change. The <a href="https://drafts.csswg.org/css-grid-3/" class="external-link" target="_blank">Editor’s Draft</a> introduces a new <code class="language-plaintext highlighter-rouge">masonry</code> value to be used for <code class="language-plaintext highlighter-rouge">grid-template-columns</code> and <code class="language-plaintext highlighter-rouge">grid-template-rows</code> properties. The snippet below creates a responsive vertical masonry grid with columns having an ideal width of <code class="language-plaintext highlighter-rouge">180px</code>, and a gap of <code class="language-plaintext highlighter-rouge">10px</code> between the elements in the grid.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#masonry-grid</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
  <span class="py">grid-template-columns</span><span class="p">:</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">auto-fit</span><span class="p">,</span> <span class="n">minmax</span><span class="p">(</span><span class="m">180px</span><span class="p">,</span> <span class="m">1</span><span class="n">fr</span><span class="p">));</span>
  <span class="py">grid-template-rows</span><span class="p">:</span> <span class="n">masonry</span><span class="p">;</span>
  <span class="py">gap</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The result would look something like this:
  </p>
<blockquote class="wikilink-embed wikilink-asset-embed" data-config="masonry-grid.png">
<a href="/assets/masonry-grid.png" class="internal-link embed-link" data-embed-url="/assets/masonry-grid.png" data-embed-fragment="">masonry-grid.png</a><div class="asset-embed meadow-embed"><img src="/assets/masonry-grid.png" alt="Image: masonry-grid" width="masonry-grid.png"></div>  </blockquote>
<span style="font-size: 0.9rem; text-align: center; display: block; margin-top: -1.2rem;">CSS Grid with <code class="language-plaintext highlighter-rouge">grid-template-rows: masonry</code></span>

<p>If your browser supports masonry grids, you can see it in action here:</p>

<p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="BabQRdR" data-user="irrelevant-space" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/irrelevant-space/pen/BabQRdR" class="external-link" target="_blank">
  CSS Masonry Grid Demo</a> by Dalia (<a href="https://codepen.io/irrelevant-space" class="external-link" target="_blank">@irrelevant-space</a>)
  on <a href="https://codepen.io" class="external-link" target="_blank">CodePen</a>.</span>
</p>

<p>Examining the result, you’ll notice that the order of the elements is horizontal, but they’re not exactly in order. The masonry layout algorithm places elements in the columns with the most remaining space to try to achieve an even look for all columns<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote internal-link" rel="footnote">4</a></sup>. If order is important, using <code class="language-plaintext highlighter-rouge">masonry-auto-flow: next</code> will place the elements in order, but the final result won’t be as even.</p>

<p>  </p>
<blockquote class="wikilink-embed wikilink-asset-embed" data-config="masonry-next.png">
<a href="/assets/masonry-next.png" class="internal-link embed-link" data-embed-url="/assets/masonry-next.png" data-embed-fragment="">masonry-next.png</a><div class="asset-embed meadow-embed"><img src="/assets/masonry-next.png" alt="Image: masonry-next" width="masonry-ne" height="t.png"></div>  </blockquote>
<span style="font-size: 0.9rem; text-align: center; display: block; margin-top: -1.2rem;">Masonry Grid with <code class="language-plaintext highlighter-rouge">masonry-auto-flow: next</code></span>

<p><br></p>

<p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="vYPyZge" data-user="irrelevant-space" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/irrelevant-space/pen/vYPyZge" class="external-link" target="_blank">
  CSS Masonry Grid Demo</a> by Dalia (<a href="https://codepen.io/irrelevant-space" class="external-link" target="_blank">@irrelevant-space</a>)
  on <a href="https://codepen.io" class="external-link" target="_blank">CodePen</a>.</span>
</p>
<p><br></p>

<h2 id="browser-support-and-fallbacks">Browser Support and Fallbacks</h2>
<p>As of writing this, the <code class="language-plaintext highlighter-rouge">masonry</code> value is only supported in Safari Technology Preview<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote internal-link" rel="footnote">5</a></sup> and in Firefox<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote internal-link" rel="footnote">6</a></sup> as an experimental feature. If any of the code samples above didn’t look right, it might be because the browser you’re using doesn’t support it yet. If you really want to use it (I know I do), then make sure to provide a fallback for other browsers.</p>

<p>The default fallback when using <code class="language-plaintext highlighter-rouge">masonry</code> in an unsupported browser, is to ignore it and use <code class="language-plaintext highlighter-rouge">auto</code> instead. This example shows what the fallback would look like.</p>

<p class="codepen" data-height="600" data-default-tab="result" data-slug-hash="zYbowKM" data-user="irrelevant-space" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/irrelevant-space/pen/zYbowKM" class="external-link" target="_blank">
  CSS Auto-Placement Grid Demo</a> by Dalia (<a href="https://codepen.io/irrelevant-space" class="external-link" target="_blank">@irrelevant-space</a>)
  on <a href="https://codepen.io" class="external-link" target="_blank">CodePen</a>.</span>
</p>
<p><br></p>

<p>If that’s not the look you’re going for, you can detect support for the <code class="language-plaintext highlighter-rouge">masonry</code> value using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@supports" class="external-link" target="_blank"><code class="language-plaintext highlighter-rouge">@supports</code></a> and provide alternative CSS for unsupported browsers. Here’s how to fallback to the column layout we saw earlier.</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#masonry-layout</span> <span class="p">{</span>
  <span class="nl">columns</span><span class="p">:</span> <span class="m">4</span> <span class="m">180px</span><span class="p">;</span>
  <span class="nl">column-gap</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@supports</span> <span class="p">(</span><span class="n">grid-template-rows</span><span class="p">:</span> <span class="n">masonry</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">#masonry-layout</span> <span class="p">{</span>
    <span class="nl">columns</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">column-gap</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="py">grid-template-columns</span><span class="p">:</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">auto-fit</span><span class="p">,</span> <span class="n">minmax</span><span class="p">(</span><span class="m">180px</span><span class="p">,</span> <span class="m">1</span><span class="n">fr</span><span class="p">));</span>
    <span class="py">grid-template-rows</span><span class="p">:</span> <span class="n">masonry</span><span class="p">;</span>
    <span class="py">gap</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>For a live example, my <a href="https://relevant.space/" class="external-link" target="_blank">personal website</a> falls back to a hacky <code class="language-plaintext highlighter-rouge">flex</code> layout if the browser doesn’t support masonry grids.</p>

<p>  </p>
<blockquote class="wikilink-embed wikilink-asset-embed" data-config="masonry-relevant.png">
<a href="/assets/masonry-relevant.png" class="internal-link embed-link" data-embed-url="/assets/masonry-relevant.png" data-embed-fragment="">masonry-relevant.png</a><div class="asset-embed meadow-embed"><img src="/assets/masonry-relevant.png" alt="Image: masonry-relevant" width="masonry-relevant.png"></div>  </blockquote>
<span style="font-size: 0.9rem; text-align: center; display: block; margin-top: -1.2rem;">The masonry grid in action</span>

<script async="" src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Google Images layout is an example of a horizontal masonry layout, while Pinterest is an example of a vertical one. <a href="#fnref:1" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>A multi-column CSS layout, flows an element’s content into columns. <a href="#fnref:2" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>The <code class="language-plaintext highlighter-rouge">column-gap</code> property only applies to the space between columns, not between rows (as the name might suggest). The space between rows can be set using <code class="language-plaintext highlighter-rouge">margin</code> on the child elements. <a href="#fnref:3" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p>The algorithm is explained in more detail in the <a href="https://drafts.csswg.org/css-grid-3/#masonry-layout-algorithm" class="external-link" target="_blank">editor’s draft</a> <a href="#fnref:4" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:5" role="doc-endnote">
      <p>Enabled since version 163. <a href="https://developer.apple.com/documentation/safari-technology-preview-release-notes/stp-release-163/#Masonry-Layout" class="external-link" target="_blank">See the release notes</a> <a href="#fnref:5" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:6" role="doc-endnote">
      <p>Available since version 77 and enabled by default in Nightly. Can be enabled from <code class="language-plaintext highlighter-rouge">about:config</code> by setting <code class="language-plaintext highlighter-rouge">layout.css.grid-template-masonry-value.enabled</code> to <code class="language-plaintext highlighter-rouge">true</code>. <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Experimental_features#masonry_grid_layout" class="external-link" target="_blank">See the release notes</a> <a href="#fnref:6" class="reversefootnote internal-link" role="doc-backlink">↩</a></p>
    </li>
  </ol>
</div>

    </div>
    <div class="side-col">
      
      <div class="note-side-wrapper card">
        <h2>Topics</h2>
        <div class="topics">
          
          <a href="/topics/css">CSS</a>
          
          <a href="/topics/web-development">Web development</a>
          
        </div>
      </div>
      

      <div class="note-side-wrapper card">
        <h2>Mentions</h2>
        <ul id="backlinks">
          <p>Fetching mentions...</p>
        </ul>
      </div>
    </div>
  </div>
</div>

<div id="link-preview" role="tooltip">
  <div id="link-preview-content">

  </div>
</div>

<script>
  let pageUrl = '/css-trivia-masonry-grid-layout/';
  fetch('/scripts/backlinks.json')
    .then(response => response.json())
    .then(data => {
      let backlinks = data[pageUrl];
      if (backlinks && backlinks.length > 0) {
        let backlinksDiv = document.getElementById('backlinks');
        backlinksDiv.innerHTML = backlinks.filter(link => {
          let currentUrl = new URL(window.location.href);
          let linkUrl = new URL(`${currentUrl.origin}${link.url[0] == '/' ? '' : '/'}${link.url}`);
          let linkPathname = linkUrl.pathname.replace(/\/$/, '');
          let currentPathname = currentUrl.pathname.replace(/\/$/, '');
          return linkPathname != currentPathname;
        }).map(link =>
          `<li><a href="${link.url}">${link.title}</a></li>`).join('');
      } else {
        let backlinksDiv = document.getElementById('backlinks');
        backlinksDiv.innerHTML = 'No mentions from other notes';
      }
    });
</script>

<script>
  let isHoveringLink = false;
  let isHoveringPreview = false;

  function prepareLinkPreviews() {
    let linkPreview = document.getElementById('link-preview');
    let linkPreviewContent = document.getElementById('link-preview-content');
    let links = document.querySelectorAll('a.internal-link:not(.wikilink-embed a):not(.embed-link):not(.broken-link):not(.reversefootnote)');
    links.forEach(link => {
      link.addEventListener('mouseover', (e) => {
        isHoveringLink = true;
        showLinkPreview(link);
      });
      link.addEventListener('mouseout', (e) => {
        isHoveringLink = false;
        if (!isHoveringPreview) {
          let linkPreview = document.getElementById('link-preview');
          setTimeout(() => {
            if (!isHoveringPreview && !isHoveringLink) {
              hidePreview();
            }
          }, 200);
        }
      });


      link.addEventListener('focus', () => {
        showLinkPreview(link);
      });

      link.addEventListener('blur', () => {
        hidePreview();
      });
    });
    linkPreview.addEventListener('mouseenter', () => {
      isHoveringPreview = true;
    });

    linkPreview.addEventListener('mouseleave', () => {
      isHoveringPreview = false;
      if (!isHoveringLink) {
        hidePreview();
      }
    });
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        hidePreview();
      }
    });
  }

  function positionPreview(link, linkPreview) {
    const linkRect = link.getBoundingClientRect();
    const previewRect = linkPreview.getBoundingClientRect();
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const spaceAbove = linkRect.top - previewRect.height - scrollTop;
    const spaceBelow = window.innerHeight - linkRect.bottom - previewRect.height + scrollTop;
    const margin = 30;
    const pageWidth = document.documentElement.clientWidth;

    if (spaceAbove >= 0 || previewRect.bottom <= scrollTop) {
      linkPreview.style.top = `${linkRect.top - previewRect.height - margin + scrollTop}px`;
    } else {
      linkPreview.style.top = `${linkRect.top + 22 - margin + scrollTop}px`;
    }

    // Check if preview overflows to the right
    if (link.offsetLeft + previewRect.width > pageWidth) {
      linkPreview.style.left = `${Math.max(0, pageWidth - previewRect.width - margin * 2)}px`;
    } else {
      linkPreview.style.left = `${Math.max(0, link.offsetLeft - margin * 2)}px`;
    }
  }

  function showLinkPreview(link) {
    let linkPreview = document.getElementById('link-preview');
    let linkPreviewContent = document.getElementById('link-preview-content');
    linkPreviewContent.innerHTML = 'Loading...';

    positionPreview(link, linkPreview);

    let linkUrl = link.href;
    if (linkUrl[0] == '#') return;
    fetch(linkUrl)
      .then(response => response.text())
      .then(data => {
        let parser = new DOMParser();
        let doc = parser.parseFromString(data, 'text/html');
        let title = doc.querySelector('#note-header h1').innerText;
        let content = '';
        let preview = '';

        if (linkUrl.includes('#')) {
          console.log(linkUrl);
          const fragmentId = linkUrl.split('#')[1];
          const fragmentEl = doc.getElementById(fragmentId);
          const headers = ['H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI'];
          if (fragmentEl && headers.indexOf(fragmentEl.tagName)) {
            const nextHeaders = headers.slice(headers.indexOf(fragmentEl.tagName));
            const elements = [fragmentEl];
            let nextEl = fragmentEl.nextElementSibling;
            while (nextEl && !nextHeaders.includes(nextEl.tagName)) {
              elements.push(nextEl);
              nextEl = nextEl.nextElementSibling;
            }
            content = elements.map(el => el.outerHTML).join('');
            preview = `<div>${content}</div>`;
          } else {
            content = doc.querySelector('#note-content .main-col').innerHTML;
            preview = `<h2>${title}</h2><div>${content}</div>`;
          }
        } else {
          content = doc.querySelector('#note-content .main-col').innerHTML;
          preview = `<h2>${title}</h2><div>${content}</div>`;
        }

        linkPreviewContent.innerHTML = preview;

        lucide.createIcons();
        linkPreview.classList.add('visible');
        linkPreview.setAttribute('aria-hidden', 'false');
      });
  }

  function hidePreview() {
    let linkPreview = document.getElementById('link-preview');
    linkPreview.classList.remove('visible');
    linkPreview.setAttribute('aria-hidden', 'false');
  }
  prepareLinkPreviews();
</script>

<script src="https://unpkg.com/lucide@latest"></script>

<script>
  lucide.createIcons();

  function toggleMeadowCallout(element) {
    let calloutId = element.getAttribute('aria-controls');
    let callout = document.getElementById(calloutId);
    let calloutTitle = callout.querySelector('.meadow-callout-title');
    let calloutContent = callout.querySelector('.meadow-callout-content');
    let calloutIcon = callout.querySelector('.meadow-callout-icon-toggle');
    let isExpanded = !callout.classList.contains('folded');
    calloutTitle.setAttribute('aria-expanded', !isExpanded);
    calloutContent.setAttribute('aria-hidden', isExpanded);
    if (isExpanded) {
      callout.classList.add('folded');
    } else {
      callout.classList.remove('folded');
    }
  }
</script>

  </main>
</body>

</html>
